<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Update Data Hujan</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #1a73e8; border-bottom: 2px solid #1a73e8; padding-bottom: 10px; }
        .section { margin-bottom: 25px; padding: 15px; border-radius: 8px; border: 1px solid #ddd; }
        .rekap-box { background: #e8f0fe; border-left: 5px solid #1a73e8; }
        .coord-box { background: #fff4e5; border-left: 5px solid #ff9800; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background: #f8f9fa; }
        input[type="number"] { padding: 8px; width: 80%; border: 1px solid #ccc; border-radius: 4px; }
        .btn { padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .btn-add { background: #28a745; color: white; }
        .btn-del { background: #dc3545; color: white; padding: 5px 10px; }
        select { padding: 12px; width: 100%; font-size: 16px; margin-bottom: 20px; border-radius: 8px; }
        #jsonOutput { background: #272c34; color: #abb2bf; padding: 15px; width: 100%; height: 200px; font-family: monospace; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Portal Database Stasiun Hujan</h2>
    
    <label><b>Pilih Stasiun untuk Dikelola:</b></label>
    <select id="selectStasiun" onchange="loadDataStasiun()">
        <option value="">-- Pilih Lokasi Stasiun --</option>
    </select>

    <div id="panelEditor" style="display:none;">
        <div class="section rekap-box">
            <h4>1) Rekapitulasi Data</h4>
            <div style="display: flex; justify-content: space-between;">
                <p>Hujan Maksimum: <b id="statMaks">0</b> mm</p>
                <p>Hujan Rerata: <b id="statRerata">0</b> mm</p>
                <p>Rentang Tahun: <b id="statRentang">-</b></p>
            </div>
        </div>

        <div class="section coord-box">
            <h4>2) Informasi Koordinat</h4>
            <p>Latitude: <span id="dispLat"></span> | Longitude: <span id="dispLng"></span></p>
        </div>

        <div class="section">
            <h4>3) Tabel Input Data Hujan (Terlama ke Terbaru)</h4>
            <table>
                <thead>
                    <tr>
                        <th>Tahun</th>
                        <th>Curah Hujan (mm)</th>
                        <th>Hapus</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
            
            <div style="margin-top: 15px; background: #f9f9f9; padding: 15px; border-radius: 5px;">
                <b>Tambah Data Baru:</b> 
                <input type="number" id="inTahun" placeholder="Tahun" style="width: 100px;">
                <input type="number" id="inHujan" placeholder="Nilai (mm)" style="width: 150px;">
                <button class="btn btn-add" onclick="tambahData()">Tambah ke Tabel</button>
            </div>
        </div>
    </div>

    <div style="margin-top: 30px;">
        <h4>JSON Hasil Akhir (Copy & Simpan ke hujan.json)</h4>
        <textarea id="jsonOutput" readonly></textarea>
        <p style="font-size: 12px; color: #666;">*Pastikan untuk selalu menyalin data ini ke file hujan.json Anda setelah selesai update.</p>
    </div>
</div>

<script>
// Data Master Awal (22 Stasiun)
let dbHujan = {
  "Kemayoran": { "koordinat": { "lat": -6.15559, "lng": 106.84000 }, "data_tahunan": [] },
  "Halim": { "koordinat": { "lat": -6.27036, "lng": 106.88926 }, "data_tahunan": [] },
  "Bogor": { "koordinat": { "lat": -6.50000, "lng": 106.75000 }, "data_tahunan": [] },
  "Banten": { "koordinat": { "lat": -6.26151, "lng": 106.75084 }, "data_tahunan": [] },
  "Katulampa": { "koordinat": { "lat": -6.63317, "lng": 106.837077 }, "data_tahunan": [] },
  "Depok": { "koordinat": { "lat": -6.40065, "lng": 106.831897 }, "data_tahunan": [] },
  "Manggarai": { "koordinat": { "lat": -6.20742, "lng": 106.848569 }, "data_tahunan": [] },
  "Karet": { "koordinat": { "lat": -6.19810, "lng": 106.810097 }, "data_tahunan": [] },
  "Setiabudi Timur": { "koordinat": { "lat": -6.20462, "lng": 106.829385 }, "data_tahunan": [] },
  "Melati": { "koordinat": { "lat": -6.20084, "lng": 106.817982 }, "data_tahunan": [] },
  "Istana": { "koordinat": { "lat": -6.17165, "lng": 106.8270424 }, "data_tahunan": [] },
  "Krukut Hulu": { "koordinat": { "lat": -6.34434, "lng": 106.799081 }, "data_tahunan": [] },
  "Sunter Hulu": { "koordinat": { "lat": -6.31785, "lng": 106.92110 }, "data_tahunan": [] },
  "Pesanggrahan": { "koordinat": { "lat": -6.39708, "lng": 106.77181 }, "data_tahunan": [] },
  "Angke Hulu": { "koordinat": { "lat": -6.21835, "lng": 106.694467 }, "data_tahunan": [] },
  "Tanjungan": { "koordinat": { "lat": -6.10669, "lng": 106.725882 }, "data_tahunan": [] },
  "Tomang Barat": { "koordinat": { "lat": -6.16710, "lng": 106.78001 }, "data_tahunan": [] },
  "Teluk Gong": { "koordinat": { "lat": -6.13350, "lng": 106.777649 }, "data_tahunan": [] },
  "Pulo Gadung": { "koordinat": { "lat": -6.19097, "lng": 106.904213 }, "data_tahunan": [] },
  "Sunter Kodamar": { "koordinat": { "lat": -6.15508, "lng": 106.886893 }, "data_tahunan": [] },
  "Sunter III Rawa Badak": { "koordinat": { "lat": -6.12107, "lng": 106.896744 }, "data_tahunan": [] },
  "Pompa Cideng": { "koordinat": { "lat": -6.17355, "lng": 106.806328 }, "data_tahunan": [] }
};

const selStasiun = document.getElementById('selectStasiun');

// Load Dropdown
Object.keys(dbHujan).forEach(nama => {
    let el = document.createElement('option');
    el.value = nama;
    el.innerText = nama;
    selStasiun.appendChild(el);
});

function loadDataStasiun() {
    const st = selStasiun.value;
    if(!st) return;
    document.getElementById('panelEditor').style.display = 'block';
    document.getElementById('dispLat').innerText = dbHujan[st].koordinat.lat;
    document.getElementById('dispLng').innerText = dbHujan[st].koordinat.lng;
    renderTable();
}

function renderTable() {
    const st = selStasiun.value;
    const dataArr = dbHujan[st].data_tahunan.sort((a,b) => a.tahun - b.tahun);
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';

    dataArr.forEach((item, index) => {
        tbody.innerHTML += `
            <tr>
                <td>${item.tahun}</td>
                <td><input type="number" value="${item.hujan}" onchange="editHujan(${index}, this.value)"></td>
                <td><button class="btn btn-del" onclick="hapusBaris(${index})">Hapus</button></td>
            </tr>
        `;
    });
    hitungRekap();
    updateOutput();
}

function tambahData() {
    const st = selStasiun.value;
    const thn = parseInt(document.getElementById('inTahun').value);
    const hjn = parseFloat(document.getElementById('inHujan').value);

    if(!thn || isNaN(hjn)) return alert("Masukkan Tahun dan Nilai Hujan!");
    
    dbHujan[st].data_tahunan.push({ tahun: thn, hujan: hjn });
    document.getElementById('inTahun').value = '';
    document.getElementById('inHujan').value = '';
    renderTable();
}

function editHujan(index, val) {
    const st = selStasiun.value;
    dbHujan[st].data_tahunan[index].hujan = parseFloat(val);
    renderTable();
}

function hapusBaris(index) {
    const st = selStasiun.value;
    dbHujan[st].data_tahunan.splice(index, 1);
    renderTable();
}

function hitungRekap() {
    const st = selStasiun.value;
    const list = dbHujan[st].data_tahunan;
    if(list.length === 0) return resetRekap();

    const vals = list.map(d => d.hujan);
    const thns = list.map(d => d.tahun);
    
    const maks = Math.max(...vals);
    const rata = (vals.reduce((a,b) => a+b, 0) / vals.length).toFixed(2);
    const rentang = Math.min(...thns) + " - " + Math.max(...thns);

    document.getElementById('statMaks').innerText = maks;
    document.getElementById('statRerata').innerText = rata;
    document.getElementById('statRentang').innerText = rentang;
}

function resetRekap() {
    document.getElementById('statMaks').innerText = 0;
    document.getElementById('statRerata').innerText = 0;
    document.getElementById('statRentang').innerText = "-";
}

function updateOutput() {
    document.getElementById('jsonOutput').value = JSON.stringify(dbHujan, null, 2);
}
</script>

</body>
</html>
