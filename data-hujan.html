<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>SDA Planning Internal Portal | Secure Access</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #0f172a; --gold: #f59e0b; --bg: #f1f5f9;
            --white: #ffffff; --border: #e2e8f0; --text: #1e293b;
        }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); margin: 0; overflow-x: hidden; }
        
        /* LOGIN GATE */
        #loginGate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--navy); display: flex; justify-content: center; align-items: center;
            z-index: 9999; transition: 0.5s;
        }
        .login-card {
            background: white; padding: 40px; border-radius: 20px; width: 400px;
            text-align: center; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3);
        }
        .login-card h2 { color: var(--navy); margin-bottom: 10px; font-weight: 800; }
        .login-card p { font-size: 13px; color: #64748b; margin-bottom: 25px; }

        /* MAIN APP */
        .navbar { background: var(--navy); padding: 15px 35px; border-bottom: 4px solid var(--gold); display: flex; justify-content: space-between; align-items: center; color: white; }
        .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
        
        .card { background: white; border-radius: 12px; border: 1px solid var(--border); padding: 25px; margin-bottom: 25px; }
        
        /* INPUT STYLES */
        input, select { 
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border);
            font-family: inherit; margin-bottom: 15px; box-sizing: border-box;
        }
        .input-edit { width: 100px; margin-bottom: 0; padding: 8px; font-weight: 700; }

        /* BUTTONS */
        .btn { 
            padding: 12px 20px; border-radius: 8px; border: none; font-weight: 700; 
            cursor: pointer; transition: 0.3s; font-family: inherit;
        }
        .btn-navy { background: var(--navy); color: white; width: 100%; }
        .btn-gold { background: var(--gold); color: var(--navy); }
        .btn-save { background: #22c55e; color: white; font-size: 11px; padding: 8px 15px; }
        .btn-add { background: #f8fafc; color: var(--navy); border: 2px dashed var(--navy); width: 100%; margin-top: 20px; }

        /* TABLES */
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8fafc; padding: 15px; text-align: left; font-size: 11px; color: #64748b; border-bottom: 2px solid var(--border); }
        td { padding: 15px; border-bottom: 1px solid var(--border); font-size: 14px; }
        
        .stats-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; }
        .stat-card { background: #f8fafc; padding: 15px; border-radius: 8px; border-left: 4px solid var(--gold); }
        .stat-label { font-size: 10px; font-weight: 800; color: #64748b; }
        .stat-value { font-size: 18px; font-weight: 800; color: var(--navy); display: block; }
    </style>
</head>
<body>

<div id="loginGate">
    <div class="login-card">
        <div style="font-size: 40px; margin-bottom: 10px;">üîê</div>
        <h2>Internal Access</h2>
        <p>Seksi Perencanaan - Masukkan GitHub Access Token Anda untuk mengelola database.</p>
        <input type="password" id="tokenInput" placeholder="ghp_xxxxxxxxxxxx">
        <button class="btn btn-navy" onclick="validateAccess()">MASUK KE PORTAL</button>
        <div style="margin-top: 15px; font-size: 11px; color: #94a3b8;">Sistem akan mengingat sesi Anda selama browser terbuka.</div>
    </div>
</div>

<div id="mainPortal" style="display:none">
    <div class="navbar">
        <div style="font-weight: 800;">SDA PLANNING <span style="color:var(--gold)">DATABASE</span></div>
        <button class="btn btn-gold" style="padding: 5px 15px; font-size: 12px;" onclick="logout()">LOGOUT</button>
    </div>

    <div class="container">
        <div class="card">
            <h3 style="margin-top:0">Manajemen Stasiun</h3>
            <select id="stSelect" onchange="loadStationData()">
                <option value="">-- Pilih Stasiun --</option>
            </select>
            
            <div id="metaDisplay" class="stats-box" style="display:none">
                <div class="stat-card"><span class="stat-label">KOORDINAT</span><span id="coordVal" class="stat-value">-</span></div>
                <div class="stat-card"><span class="stat-label">RERATA SERIES</span><span id="avgVal" class="stat-value">-</span></div>
                <div class="stat-card"><span class="stat-label">MAKSIMUM</span><span id="maxVal" class="stat-value">-</span></div>
            </div>
        </div>

        <div id="dataTableCard" class="card" style="display:none; padding: 0;">
            <table id="rainTable">
                <thead>
                    <tr>
                        <th>TAHUN</th>
                        <th>CURAH HUJAN (mm)</th>
                        <th>STATUS</th>
                        <th>KONFIRMASI</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
            <div style="padding: 20px;">
                <button class="btn btn-add" onclick="addNewYearRow()">+ TAMBAH DATA TAHUN BERIKUTNYA</button>
            </div>
        </div>
    </div>
</div>

<script>
    // DATA JSON DINAMIS
    let masterData = {
        "st_01": { n: "Kemayoran", lat: -6.15559, lng: 106.840, d: [94.8, 82.2, 168.5, 199.7, 129.3, 124.1, 72.0, 234.7, 192.7, 122.5, 93.0, 119.2, 105.2, 193.4, 147.9, 277.5, 124.5, 179.7, 104.6, 90.5, 277.5, 94.1, 204.0, 79.5, 140.9] },
        "st_22": { n: "Pompa Cideng", lat: -6.17320, lng: 106.806, d: [89.5, 85.6, 152.4, 145.2, 118.4, 103.9, 108.4, 204.5, 118.4, 115.4, 103.9, 142.0, 103.9, 162.4, 145.2, 165.4, 110.4, 103.9, 118.4, 115.4, 212.4, 103.9, 132.4, 108.4, 140.0] }
    };

    // 1. SISTEM LOGIN & "REMEMBER SESSION"
    window.onload = function() {
        const sessionToken = sessionStorage.getItem('sda_token');
        if(sessionToken === "SDA2024") { // Ganti dengan token internal sesungguhnya
            showPortal();
        }
        initSelect();
    };

    function validateAccess() {
        const token = document.getElementById('tokenInput').value;
        if(token === "RENTEKSDAJS") { // Password/Token Gate
            sessionStorage.setItem('sda_token', token);
            showPortal();
        } else {
            alert("Token Tidak Valid! Akses Ditolak.");
        }
    }

    function showPortal() {
        document.getElementById('loginGate').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('loginGate').style.display = 'none';
            document.getElementById('mainPortal').style.display = 'block';
        }, 500);
    }

    function logout() {
        sessionStorage.removeItem('sda_token');
        location.reload();
    }

    // 2. LOAD DATA STASIUN KE SELECT
    function initSelect() {
        const sel = document.getElementById('stSelect');
        Object.keys(masterData).forEach(key => {
            let opt = document.createElement('option');
            opt.value = key;
            opt.innerHTML = masterData[key].n;
            sel.appendChild(opt);
        });
    }

    // 3. RENDER TABEL & STATS
    function loadStationData() {
        const id = document.getElementById('stSelect').value;
        if(!id) return;
        
        document.getElementById('metaDisplay').style.display = 'grid';
        document.getElementById('dataTableCard').style.display = 'block';
        
        renderRows(id);
    }

    function renderRows(id) {
        const tbody = document.getElementById('tableBody');
        const dataset = masterData[id].d;
        tbody.innerHTML = "";
        
        dataset.forEach((val, i) => {
            const row = `<tr>
                <td><strong>${2000 + i}</strong></td>
                <td><input type="number" step="0.1" class="input-edit" id="val-${i}" value="${val}"></td>
                <td><span style="color:#22c55e; font-size:10px; font-weight:800;">VERIFIED</span></td>
                <td><button class="btn btn-save" onclick="pushToDatabase('${id}', ${i})">PUSH UPDATE</button></td>
            </tr>`;
            tbody.innerHTML += row;
        });
        
        updateStats(dataset, id);
    }

    // 4. MENU TAMBAH DATA TAHUN BERIKUTNYA
    function addNewYearRow() {
        const id = document.getElementById('stSelect').value;
        if(!id) return;
        
        const currentData = masterData[id].d;
        const newYear = 2000 + currentData.length;
        
        if(confirm(`Siapkan baris input untuk tahun baru ${newYear}?`)) {
            masterData[id].d.push(0); // Tambah 1 data kosong ke JSON
            renderRows(id); // Render ulang tabel
            alert("Baris tahun " + newYear + " berhasil ditambahkan. Silakan isi angka dan Push Update.");
        }
    }

    function pushToDatabase(stId, idx) {
        const newVal = document.getElementById(`val-${idx}`).value;
        masterData[stId].d[idx] = parseFloat(newVal);
        
        // Simpan ke LocalStorage agar editan tidak hilang saat refresh
        localStorage.setItem('sda_master_db', JSON.stringify(masterData));
        
        renderRows(stId);
        alert("Data Sukses Dipush ke Database Internal!");
    }

    function updateStats(data, id) {
        document.getElementById('coordVal').innerText = masterData[id].lat + ", " + masterData[id].lng;
        document.getElementById('maxVal').innerText = Math.max(...data).toFixed(1) + " mm";
        document.getElementById('avgVal').innerText = (data.reduce((a,b)=>a+b,0)/data.length).toFixed(1) + " mm";
    }
</script>
</body>
</html>
