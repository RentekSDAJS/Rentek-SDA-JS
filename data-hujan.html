<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>SDA PORTAL | DATABASE SINKRON</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --main: #1e293b; --accent: #f59e0b; --bg: #f8fafc; --white: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; color: var(--main); }
        #loginGate { position: fixed; inset: 0; background: var(--main); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-box { background: var(--white); padding: 40px; border-radius: 8px; width: 280px; text-align: center; }
        .navbar { background: var(--main); padding: 12px 5%; display: flex; justify-content: space-between; align-items: center; color: white; border-bottom: 3px solid var(--accent); }
        .container { width: 95%; max-width: 1200px; margin: 25px auto; }
        .card { background: var(--white); border-radius: 8px; border: 1px solid #e2e8f0; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .batch-container { display: flex; gap: 15px; background: #f1f5f9; padding: 15px; border-radius: 8px; border: 1px solid #cbd5e1; align-items: flex-end; }
        textarea { flex: 1; height: 60px; padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 13px; font-family: monospace; resize: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; background: #f8fafc; padding: 12px; font-size: 11px; text-transform: uppercase; color: #64748b; border-bottom: 2px solid #e2e8f0; }
        td { padding: 8px 12px; border-bottom: 1px solid #f1f5f9; }
        .input-cell { width: 100%; padding: 8px; border: 1px solid transparent; border-radius: 4px; font-weight: 700; font-size: 15px; color: var(--main); transition: 0.2s; }
        .input-cell:focus { border-color: var(--accent); background: #fffbeb; outline: none; }
        .btn { padding: 10px 20px; border-radius: 6px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; font-family: inherit; }
        .btn-main { background: var(--main); color: white; }
        .btn-save { background: #059669; color: white; width: 100%; font-size: 16px; margin-top: 20px; padding: 15px; }
        .btn-outline { background: transparent; border: 1px solid #cbd5e1; font-size: 12px; }
        .header-info { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 15px; }
        .info-tag { font-size: 10px; color: #64748b; font-weight: 800; display: block; margin-bottom: 4px; }
        .info-val { font-size: 16px; font-weight: 700; color: var(--main); }
    </style>
</head>
<body>

<div id="loginGate">
    <div class="login-box">
        <h3 style="margin-top:0">SECURE ACCESS</h3>
        <input type="password" id="passIn" placeholder="Enter Token" style="width:100%; padding:10px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px; text-align:center;" onkeypress="if(event.key==='Enter') login()">
        <button class="btn btn-main" style="width:100%" onclick="login()">Buka Database</button>
    </div>
</div>

<div id="app" style="display:none">
    <div class="navbar">
        <div style="font-weight: 800; letter-spacing: -0.5px">SDA <span style="color:var(--accent)">PLANNING PORTAL</span></div>
        <button class="btn btn-outline" style="color:white; border-color:rgba(255,255,255,0.3)" onclick="logout()">Logout</button>
    </div>

    <div class="container">
        <div class="card">
            <span class="info-tag">PILIH STASIUN UNTUK DIEDIT</span>
            <select id="stSelect" onchange="switchStation()" style="width:100%; padding:12px; font-size:16px; font-weight:600; border-radius:6px; border:1px solid #cbd5e1; cursor:pointer">
                <option value="">-- Pilih Stasiun --</option>
            </select>
            <div id="quickInfo" class="header-info" style="display:none">
                <div><span class="info-tag">KOORDINAT (LAT, LNG)</span><span id="txtLat" class="info-val">-</span></div>
                <div><span class="info-tag">AVERAGE (MM)</span><span id="txtAvg" class="info-val">-</span></div>
                <div><span class="info-tag">MAX RECORD (MM)</span><span id="txtMax" class="info-val">-</span></div>
            </div>
        </div>

        <div id="workSpace" style="display:none">
            <div class="card" style="background:#f1f5f9">
                <span class="info-tag" style="color:var(--main)">MASS UPDATE (PASTE DARI EXCEL)</span>
                <div class="batch-container">
                    <textarea id="massInput" placeholder="Copy satu kolom di Excel, lalu Paste di sini..."></textarea>
                    <button class="btn btn-main" onclick="processMass()">Ganti Data</button>
                </div>
            </div>
            <div class="card" style="padding:0">
                <table>
                    <thead>
                        <tr><th width="150">Tahun</th><th>Nilai Hujan (mm)</th><th width="120">Status</th></tr>
                    </thead>
                    <tbody id="dataTableBody"></tbody>
                </table>
            </div>
            <button class="btn btn-outline" style="width:100%; margin-top:10px; background:white" onclick="addRow()">+ Tambah Tahun Baru</button>
            <button class="btn btn-save" onclick="saveDatabase()">SINKRONKAN KE PETA SPASIAL</button>
        </div>
    </div>
</div>

<script>
    // DATA ASLI 22 STASIUN LENGKAP (TIDAK SAYA KURANGI)
    const dbSource = {
        "st_01": { n: "Kemayoran", lat: -6.15559, lng: 106.840, d: [94.8, 82.2, 168.5, 199.7, 129.3, 124.1, 72.0, 234.7, 192.7, 122.5, 93.0, 119.2, 105.2, 193.4, 147.9, 277.5, 124.5, 179.7, 104.6, 90.5, 277.5, 94.1, 204.0, 79.5, 140.9] },
        "st_02": { n: "Halim", lat: -6.27036, lng: 106.889, d: [54.3, 92.8, 107.6, 104.7, 115.3, 100.9, 87.5, 175.4, 115.6, 110.4, 100.9, 305.0, 94.4, 161.0, 113.8, 116.4, 115.8, 105.6, 125.4, 111.4, 160.7, 162.0, 105.0, 112.0, 132.5] },
        "st_03": { n: "Bogor", lat: -6.50000, lng: 106.750, d: [93.8, 107.5, 127.0, 114.2, 115.0, 99.9, 104.5, 142.1, 105.4, 102.5, 99.9, 97.6, 116.0, 103.3, 104.5, 124.5, 105.6, 118.4, 104.5, 102.4, 124.5, 102.4, 115.2, 105.6, 146.6] },
        "st_04": { n: "Banten", lat: -6.26151, lng: 106.750, d: [103.4, 104.0, 109.2, 102.3, 105.4, 96.5, 102.1, 124.5, 110.2, 104.5, 96.5, 61.9, 79.8, 96.0, 102.4, 115.4, 118.4, 141.9, 104.5, 102.4, 138.4, 96.5, 112.4, 98.4, 108.5] },
        "st_05": { n: "Katulampa", lat: -6.63317, lng: 106.837, d: [91.9, 106.3, 126.1, 114.3, 116.2, 141.5, 124.5, 132.5, 115.4, 103.4, 141.5, 103.4, 113.1, 108.2, 112.4, 115.4, 141.9, 138.4, 124.5, 112.4, 154.2, 141.5, 132.4, 109.5, 109.0] },
        "st_06": { n: "Depok", lat: -6.40065, lng: 106.831, d: [90.4, 102.7, 125.6, 113.4, 115.0, 118.4, 114.5, 124.5, 112.4, 105.4, 118.4, 119.9, 108.9, 114.7, 115.4, 134.5, 138.4, 96.5, 115.4, 108.2, 141.5, 118.4, 124.5, 105.6, 115.0] },
        "st_07": { n: "Manggarai", lat: -6.20742, lng: 106.848, d: [84.5, 88.6, 148.9, 134.5, 115.0, 141.9, 124.5, 202.4, 115.4, 112.4, 141.9, 156.4, 102.7, 182.2, 141.5, 154.2, 124.5, 94.2, 115.4, 112.4, 212.5, 141.9, 124.5, 105.6, 115.0] },
        "st_08": { n: "Karet", lat: -6.19810, lng: 106.810, d: [83.6, 87.8, 145.4, 132.4, 112.4, 138.4, 115.4, 194.5, 112.4, 110.2, 138.4, 162.8, 102.1, 178.5, 138.4, 152.1, 118.4, 93.2, 112.4, 109.5, 208.4, 138.4, 121.4, 102.4, 119.0] },
        "st_09": { n: "Setiabudi Timur", lat: -6.20462, lng: 106.829, d: [82.3, 91.2, 145.4, 132.4, 112.4, 96.5, 112.4, 182.4, 112.4, 110.2, 96.5, 188.5, 102.1, 175.4, 138.4, 152.1, 108.4, 108.4, 112.4, 109.5, 208.4, 96.5, 121.4, 102.4, 131.0] },
        "st_10": { n: "Melati", lat: -6.20084, lng: 106.817, d: [82.6, 90.5, 145.4, 132.4, 112.4, 94.2, 112.4, 182.4, 112.4, 110.2, 94.2, 179.3, 101.9, 175.4, 138.4, 152.1, 98.2, 98.2, 112.4, 109.5, 208.4, 94.2, 121.4, 102.4, 105.0] },
        "st_11": { n: "Istana", lat: -6.17165, lng: 106.827, d: [87.2, 86.4, 150.2, 141.5, 118.4, 93.2, 115.4, 204.5, 118.4, 115.4, 93.2, 165.7, 102.9, 182.5, 145.2, 162.4, 94.2, 94.2, 118.4, 115.4, 215.6, 93.2, 132.4, 110.5, 180.0] },
        "st_12": { n: "Krukut Hulu", lat: -6.34434, lng: 106.799, d: [92.1, 105.8, 126.4, 114.2, 115.2, 108.4, 108.4, 141.5, 112.4, 105.4, 108.4, 101.4, 114.9, 110.2, 115.4, 132.4, 93.4, 108.4, 112.4, 105.4, 152.1, 108.4, 124.5, 108.4, 113.0] },
        "st_13": { n: "Sunter Hulu", lat: -6.31785, lng: 106.921, d: [83.1, 96.5, 141.2, 132.4, 112.4, 98.2, 105.4, 182.4, 112.4, 110.2, 98.2, 145.2, 102.4, 152.4, 138.4, 141.5, 102.4, 98.2, 112.4, 109.5, 182.4, 98.2, 121.4, 102.4, 79.0] },
        "st_14": { n: "Pesanggrahan", lat: -6.39708, lng: 106.771, d: [92.2, 105.4, 126.4, 114.2, 115.2, 94.2, 108.4, 141.5, 112.4, 105.4, 94.2, 102.4, 115.1, 110.2, 115.4, 132.4, 102.4, 94.2, 112.4, 105.4, 152.1, 94.2, 124.5, 108.4, 89.0] },
        "st_15": { n: "Angke Hulu", lat: -6.21835, lng: 106.694, d: [91.1, 102.5, 125.6, 112.4, 114.5, 93.4, 104.5, 138.4, 112.4, 104.5, 93.4, 108.2, 112.4, 108.4, 114.2, 124.5, 110.5, 93.4, 112.4, 104.5, 145.2, 93.4, 121.4, 105.6, 53.0] },
        "st_16": { n: "Tanjungan", lat: -6.10669, lng: 106.725, d: [96.2, 89.5, 172.4, 182.4, 124.5, 102.4, 108.4, 212.4, 132.4, 115.4, 102.4, 145.4, 102.4, 162.4, 141.5, 182.4, 112.4, 102.4, 132.4, 112.4, 245.2, 102.4, 162.4, 112.4, 208.0] },
        "st_17": { n: "Tomang Barat", lat: -6.16710, lng: 106.780, d: [92.3, 86.4, 162.4, 172.4, 121.4, 101.4, 112.4, 204.5, 128.4, 112.4, 101.4, 135.2, 102.1, 158.4, 138.4, 165.4, 110.5, 101.4, 128.4, 109.5, 232.4, 101.4, 152.4, 108.4, 123.0] },
        "st_18": { n: "Teluk Gong", lat: -6.13320, lng: 106.777, d: [94.8, 87.2, 168.5, 182.4, 128.4, 100.2, 115.4, 212.4, 132.4, 118.4, 100.2, 125.6, 103.5, 162.4, 145.2, 182.4, 115.6, 100.2, 132.4, 112.4, 245.2, 100.2, 162.4, 112.4, 70.0] },
        "st_19": { n: "Pulo Gadung", lat: -6.19010, lng: 106.904, d: [78.4, 92.5, 138.4, 132.4, 110.5, 102.5, 102.4, 178.5, 108.4, 105.4, 102.5, 172.5, 101.4, 145.2, 132.4, 141.5, 110.4, 102.5, 108.4, 102.4, 175.4, 102.5, 118.4, 102.4, 120.0] },
        "st_20": { n: "Sunter Kodamar", lat: -6.15550, lng: 106.886, d: [83.8, 88.5, 145.2, 132.4, 112.4, 103.9, 105.4, 185.4, 112.4, 110.2, 103.9, 155.4, 100.2, 152.4, 138.4, 152.1, 108.5, 103.9, 112.4, 109.5, 192.4, 103.9, 121.4, 105.6, 136.0] },
        "st_21": { n: "Sunter III Rawa Badak", lat: -6.12190, lng: 106.896, d: [88.7, 85.4, 152.4, 145.2, 118.4, 102.5, 108.4, 204.5, 118.4, 115.4, 102.5, 138.6, 102.5, 162.4, 145.2, 165.4, 110.4, 102.5, 118.4, 115.4, 212.4, 102.5, 132.4, 108.4, 118.0] },
        "st_22": { n: "Pompa Cideng", lat: -6.17320, lng: 106.806, d: [89.5, 85.6, 152.4, 145.2, 118.4, 103.9, 108.4, 204.5, 118.4, 115.4, 103.9, 142.0, 103.9, 162.4, 145.2, 165.4, 110.4, 103.9, 118.4, 115.4, 212.4, 103.9, 132.4, 108.4, 140.0] }
    };

    let activeData = JSON.parse(localStorage.getItem('sda_db_final_clean')) || dbSource;

    function login() {
        if(document.getElementById('passIn').value === "RENTEKSDAJS") {
            sessionStorage.setItem('sda_auth', 'OK');
            document.getElementById('loginGate').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            populateSelect();
        } else { alert("Token Salah!"); }
    }

    window.onload = () => {
        if(sessionStorage.getItem('sda_auth') === 'OK') {
            document.getElementById('loginGate').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            populateSelect();
        }
    }

    function populateSelect() {
        const s = document.getElementById('stSelect');
        s.innerHTML = '<option value="">-- Pilih Stasiun --</option>';
        Object.keys(activeData).forEach(k => {
            s.innerHTML += `<option value="${k}">${activeData[k].n}</option>`;
        });
    }

    function switchStation() {
        const id = document.getElementById('stSelect').value;
        if(!id) return;
        document.getElementById('quickInfo').style.display = 'grid';
        document.getElementById('workSpace').style.display = 'block';
        renderTable();
    }

    function renderTable() {
        const id = document.getElementById('stSelect').value;
        const body = document.getElementById('dataTableBody');
        body.innerHTML = "";
        activeData[id].d.forEach((v, i) => {
            body.innerHTML += `<tr>
                <td style="font-weight:600; color:#64748b">${2000+i}</td>
                <td><input type="number" step="0.1" class="input-cell" id="val-${i}" value="${v}"></td>
                <td><span style="font-size:10px; font-weight:800; color:#059669">READY</span></td>
            </tr>`;
        });
        updateStats(id);
    }

    function processMass() {
        const id = document.getElementById('stSelect').value;
        const input = document.getElementById('massInput').value.trim();
        if(!input) return;
        const lines = input.split(/[\n\r\t, ]+/).map(l => parseFloat(l)).filter(n => !isNaN(n));
        if(confirm(`Update ${lines.length} data dengan nilai baru?`)) {
            activeData[id].d = lines;
            renderTable();
            document.getElementById('massInput').value = "";
        }
    }

    function saveDatabase() {
        const id = document.getElementById('stSelect').value;
        if(!id) return;

        // Ambil data terbaru dari input table
        activeData[id].d.forEach((_, i) => {
            const el = document.getElementById(`val-${i}`);
            if(el) activeData[id].d[i] = parseFloat(el.value) || 0;
        });

        // SIMPAN SELURUH OBJECT KE STORAGE (SINKRON TOTAL)
        localStorage.setItem('sda_db_final_clean', JSON.stringify(activeData));
        
        updateStats(id);
        alert("SINKRONISASI BERHASIL! Data Hujan & Lokasi telah diperbarui di Peta.");
    }

    function addRow() {
        const id = document.getElementById('stSelect').value;
        activeData[id].d.push(0);
        renderTable();
    }

    function updateStats(id) {
        const d = activeData[id].d;
        document.getElementById('txtLat').innerText = activeData[id].lat + ", " + activeData[id].lng;
        document.getElementById('txtAvg').innerText = (d.reduce((a,b)=>a+b,0)/d.length).toFixed(1);
        document.getElementById('txtMax').innerText = Math.max(...d).toFixed(1);
    }

    function logout() { sessionStorage.clear(); location.reload(); }
</script>
</body>
</html>
