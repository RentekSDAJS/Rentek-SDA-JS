<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Portal Data Hujan Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --accent: #38bdf8;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --danger: #ef4444;
            --success: #22c55e;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-dark); 
            color: var(--text-main); 
            margin: 0; padding: 20px;
        }

        .dashboard { max-width: 1100px; margin: auto; }
        
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 15px;
        }

        .card { 
            background: var(--card-bg); border-radius: 12px; padding: 20px; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); margin-bottom: 20px;
        }

        .grid-rekap { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .stat-item { text-align: center; border-right: 1px solid #334155; }
        .stat-item:last-child { border: none; }
        .stat-val { display: block; font-size: 24px; font-weight: 600; color: var(--accent); }
        .stat-label { font-size: 12px; color: var(--text-dim); text-transform: uppercase; }

        select, input, textarea {
            background: #0f172a; border: 1px solid #334155; color: white;
            padding: 10px; border-radius: 6px; font-family: inherit;
        }

        select { width: 100%; cursor: pointer; }

        .bulk-area { margin-top: 15px; }
        textarea { width: 100%; height: 80px; resize: none; border-color: var(--accent); }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        th { text-align: left; color: var(--text-dim); padding: 10px; border-bottom: 2px solid #334155; }
        td { padding: 10px; border-bottom: 1px solid #334155; }

        .btn { 
            padding: 8px 16px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer;
            transition: 0.2s;
        }
        .btn-primary { background: var(--accent); color: var(--bg-dark); }
        .btn-ghost { background: transparent; color: var(--text-dim); border: 1px solid #334155; }
        .btn-primary:hover { opacity: 0.8; }

        #exportArea { display: none; margin-top: 20px; }
    </style>
</head>
<body>

<div class="dashboard">
    <header>
        <div style="font-size: 20px; font-weight: 600;">PORTAL <span style="color: var(--accent);">DATA HUJAN</span></div>
        <div style="width: 300px;">
            <select id="stasiunSelect" onchange="initStasiun()">
                <option value="">Pilih Stasiun...</option>
            </select>
        </div>
    </header>

    <div id="mainContent" style="display: none;">
        <div class="grid-rekap card">
            <div class="stat-item">
                <span class="stat-label">Hujan Maksimum</span>
                <span id="statMaks" class="stat-val">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Hujan Rerata</span>
                <span id="statRerata" class="stat-val">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Rentang Tahun</span>
                <span id="statRentang" class="stat-val">-</span>
            </div>
        </div>

        <div class="card">
            <div style="color: var(--text-dim); font-size: 13px; margin-bottom: 10px;">
                KOORDINAT: <span id="valLat" style="color: var(--accent);"></span>, <span id="valLng" style="color: var(--accent);"></span>
            </div>
            <div class="bulk-area">
                <label style="font-size: 14px; font-weight: 600; margin-bottom: 5px; display: block;">Bulk Paste Data (Tahun 2000-2024):</label>
                <textarea id="bulkInput" placeholder="Copy satu kolom di Excel lalu paste di sini..."></textarea>
                <button class="btn btn-primary" style="margin-top: 10px; width: 100%;" onclick="processBulk()">Proses Data</button>
            </div>
        </div>

        <div class="card">
            <table id="hujanTable">
                <thead>
                    <tr>
                        <th>TAHUN</th>
                        <th>CURAH HUJAN (mm)</th>
                        <th>STATUS</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <div style="display: flex; gap: 10px;">
        <button class="btn btn-ghost" onclick="toggleExport()">Tampilkan JSON Export</button>
        <button class="btn btn-primary" onclick="downloadJSON()">Simpan File</button>
    </div>

    <div id="exportArea" class="card">
        <textarea id="jsonOutput" style="height: 200px; font-size: 12px;"></textarea>
    </div>
</div>

<script>
// Database di-init kosong sesuai daftar 22 stasiun
let dbHujan = {
    "Kemayoran": { "koordinat": { "lat": -6.15559, "lng": 106.84000 }, "data_tahunan": [] },
    "Halim": { "koordinat": { "lat": -6.27036, "lng": 106.88926 }, "data_tahunan": [] },
    "Bogor": { "koordinat": { "lat": -6.50000, "lng": 106.75000 }, "data_tahunan": [] },
    "Banten": { "koordinat": { "lat": -6.26151, "lng": 106.75084 }, "data_tahunan": [] },
    "Katulampa": { "koordinat": { "lat": -6.63317, "lng": 106.837077 }, "data_tahunan": [] },
    "Depok": { "koordinat": { "lat": -6.40065, "lng": 106.831897 }, "data_tahunan": [] },
    "Manggarai": { "koordinat": { "lat": -6.20742, "lng": 106.848569 }, "data_tahunan": [] },
    "Karet": { "koordinat": { "lat": -6.19810, "lng": 106.810097 }, "data_tahunan": [] },
    "Setiabudi Timur": { "koordinat": { "lat": -6.20462, "lng": 106.829385 }, "data_tahunan": [] },
    "Melati": { "koordinat": { "lat": -6.20084, "lng": 106.817982 }, "data_tahunan": [] },
    "Istana": { "koordinat": { "lat": -6.17165, "lng": 106.8270424 }, "data_tahunan": [] },
    "Krukut Hulu": { "koordinat": { "lat": -6.34434, "lng": 106.799081 }, "data_tahunan": [] },
    "Sunter Hulu": { "koordinat": { "lat": -6.31785, "lng": 106.92110 }, "data_tahunan": [] },
    "Pesanggrahan": { "koordinat": { "lat": -6.39708, "lng": 106.77181 }, "data_tahunan": [] },
    "Angke Hulu": { "koordinat": { "lat": -6.21835, "lng": 106.694467 }, "data_tahunan": [] },
    "Tanjungan": { "koordinat": { "lat": -6.10669, "lng": 106.725882 }, "data_tahunan": [] },
    "Tomang Barat": { "koordinat": { "lat": -6.16710, "lng": 106.78001 }, "data_tahunan": [] },
    "Teluk Gong": { "koordinat": { "lat": -6.13350, "lng": 106.777649 }, "data_tahunan": [] },
    "Pulo Gadung": { "koordinat": { "lat": -6.19097, "lng": 106.904213 }, "data_tahunan": [] },
    "Sunter Kodamar": { "koordinat": { "lat": -6.15508, "lng": 106.886893 }, "data_tahunan": [] },
    "Sunter III Rawa Badak": { "koordinat": { "lat": -6.12107, "lng": 106.896744 }, "data_tahunan": [] },
    "Pompa Cideng": { "koordinat": { "lat": -6.17355, "lng": 106.806328 }, "data_tahunan": [] }
};

const select = document.getElementById('stasiunSelect');
Object.keys(dbHujan).forEach(s => {
    let opt = document.createElement('option');
    opt.value = s; opt.innerText = s;
    select.appendChild(opt);
});

function initStasiun() {
    const s = select.value;
    if(!s) return;
    document.getElementById('mainContent').style.display = 'block';
    document.getElementById('valLat').innerText = dbHujan[s].koordinat.lat;
    document.getElementById('valLng').innerText = dbHujan[s].koordinat.lng;
    renderTable();
}

function processBulk() {
    const s = select.value;
    const input = document.getElementById('bulkInput').value;
    const baris = input.split(/\r?\n/).filter(x => x.trim() !== "");
    
    // Asumsi data berurutan 2000 ke 2024
    dbHujan[s].data_tahunan = baris.map((val, i) => ({
        tahun: 2000 + i,
        hujan: parseFloat(val.replace(',', '.')) || 0
    }));

    document.getElementById('bulkInput').value = "";
    renderTable();
}

function renderTable() {
    const s = select.value;
    const list = dbHujan[s].data_tahunan;
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = "";

    if(list.length > 0) {
        list.forEach(item => {
            tbody.innerHTML += `<tr><td>${item.tahun}</td><td>${item.hujan}</td><td style="color:var(--success)">Valid</td></tr>`;
        });

        const vals = list.map(d => d.hujan);
        document.getElementById('statMaks').innerText = Math.max(...vals);
        document.getElementById('statRerata').innerText = (vals.reduce((a,b) => a+b, 0) / vals.length).toFixed(1);
        document.getElementById('statRentang').innerText = "2000 - 2024";
    }
    updateExport();
}

function updateExport() {
    document.getElementById('jsonOutput').value = JSON.stringify(dbHujan, null, 2);
}

function toggleExport() {
    const area = document.getElementById('exportArea');
    area.style.display = area.style.display === 'none' ? 'block' : 'none';
}

function downloadJSON() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dbHujan, null, 2));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href",     dataStr);
    downloadAnchorNode.setAttribute("download", "hujan.json");
    document.body.appendChild(downloadAnchorNode); 
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
}
</script>
</body>
</html>
